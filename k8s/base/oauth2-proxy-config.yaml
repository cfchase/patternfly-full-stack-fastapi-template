apiVersion: v1
kind: ConfigMap
metadata:
  name: oauth2-proxy-config
  labels:
    app: oauth2-proxy
data:
  oauth2_proxy.cfg: |
    # OAuth2 Proxy Configuration
    # Provider will be set via environment variables for flexibility

    # Email domains allowed (use ["*"] for any domain)
    email_domains = ["*"]

    # Upstream configuration
    upstreams = ["http://127.0.0.1:8000"]

    # Header configuration
    pass_user_headers = true
    pass_access_token = false
    pass_authorization_header = false
    pass_basic_auth = false

    # Set X-Forwarded-* headers
    set_xauthrequest = false

    # Skip authentication for health check endpoint
    skip_auth_routes = [
      "^/api/v1/utils/health-check$"
    ]

    # Cookie configuration
    cookie_name = "_oauth2_proxy"
    cookie_secure = true
    cookie_httponly = true
    cookie_samesite = "lax"

    # Session configuration
    cookie_expire = "168h"  # 7 days
    cookie_refresh = "1h"

    # Logging
    request_logging = true
    auth_logging = true

    # Reverse proxy mode (trust X-Forwarded-* headers from ingress)
    reverse_proxy = true
